<!DOCTYPE html><html><head>	<title>Congress</title>	<meta http-equiv="Content-Type" content="text/html;	charset=ISO-8859-1">	<style>		#bills td {width:250px; padding: 2px 80px;}		#bills {padding:30px 0px;}		#jsontable td {padding:2px 70px;}	</style>	<script>		function clearForm()		{			document.congress.chamber[0].checked = true;			document.congress.database[0].selected = true;			document.congress.keyword.value = "";			document.getElementById('keyword_label').innerHTML = "Keyword*";			document.getElementById('result').innerHTML = "";			document.congress.keywordLabel.value = "Keyword*";		}		function createHiddenForm(a, chamber, d, keyword, label)		{			var form = document.createElement("form");			form.setAttribute("method", "post");			form.setAttribute("action", "<?php echo $_SERVER['PHP_SELF'] ?>");			var hiddenFieldHash3 = document.createElement("input");			hiddenFieldHash3.setAttribute("type", "hidden");			hiddenFieldHash3.setAttribute("name", "details");			hiddenFieldHash3.setAttribute("value", a);			form.appendChild(hiddenFieldHash3);			document.body.appendChild(form);			var hiddenFieldHash1 = document.createElement("input");			hiddenFieldHash1.setAttribute("type", "hidden");			hiddenFieldHash1.setAttribute("name", "database");			hiddenFieldHash1.setAttribute("value", d);			form.appendChild(hiddenFieldHash1);			document.body.appendChild(form);			var hiddenFieldHash2 = document.createElement("input");			hiddenFieldHash2.setAttribute("type", "hidden");			hiddenFieldHash2.setAttribute("name", "keyword");			hiddenFieldHash2.setAttribute("value", keyword);			form.appendChild(hiddenFieldHash2);			document.body.appendChild(form);			var hiddenFieldHash = document.createElement("input");			hiddenFieldHash.setAttribute("type", "hidden");			hiddenFieldHash.setAttribute("name", "chamber");			hiddenFieldHash.setAttribute("value", chamber);			form.appendChild(hiddenFieldHash);			document.body.appendChild(form);			var hiddenFieldHash5 = document.createElement("input");			hiddenFieldHash5.setAttribute("type", "hidden");			hiddenFieldHash5.setAttribute("name", "keywordLabel");			hiddenFieldHash5.setAttribute("value", label);			form.appendChild(hiddenFieldHash5);			document.body.appendChild(form);			form.submit();		}		function changeKeywordLabel()		{			d = document.congress.database.value;			text = "";			if (d == "-1") 			{				text = "Keyword*";			}			else if (d == "legislators")			{				text = "State/Representative*";			}			else if (d == "committees")			{				text = "Committee ID*";			}			else if (d == "bills")			{				text = "Bill ID*";			}			else if (d == "amendments")			{				text = "Amendment ID*";			}			document.getElementById('keyword_label').innerHTML=text;			document.congress.keywordLabel.value = text;			document.getElementById('keyword_id').value = "";			$keyword="";		}	</script></head><body style="margin: auto; text-align: center;">	<?php	error_reporting(E_STRICT);	ini_set("allow_url_fopen", 1);	$database = "";	$chamber = "";	$keyword = "";	$keyword_label = "Keyword*";	$err = [];	if ($_SERVER["REQUEST_METHOD"] == "POST") {		if (empty($_POST["database"]) || $_POST["database"] == "-1") {			$err[] = "Congress Database";		} else {			$database = $_POST['database'];		}		$k = trim($_POST["keyword"]);		if (empty($k) == 1) {			$err[] = "keyword";		} else {			$keyword = trim($_POST["keyword"]);		}		$chamber = $_POST["chamber"];		$keyword_label = $_POST['keywordLabel'];	}	if(count($err) > 0)	{		$text = "";		foreach ($err as $e) {			$text .= $e . ", ";		}		$text = trim($text, ", ");		echo '<script language="javascript">';		echo 'alert("Please enter the following missing information: ' . $text . '")';		echo '</script>';	}	?>	<h1>Congress Information Search</h1>	<div id="search" style="border: 2px solid black; margin:auto; width:300px; padding:5px;">		<form name="congress" method="post" action="<?php echo $_SERVER['PHP_SELF'] ?>">			<table id="search" border=0 style="text-align: center;">				<tr>					<td><label id="congress_database">Congress Database </label></td>					<td><select name="database" id="db_id" onchange="javascript:changeKeywordLabel()">						<option value="-1" <?php if (isset($database) && $database=="-1") echo "selected";?> >Select your option</option>						<option value="legislators" <?php if (isset($database) && $database=="legislators") echo "selected";?>  >Legislators</option>						<option value="committees" <?php if (isset($database) && $database=="committees") echo "selected";?> >Committees</option>						<option value="bills" <?php if (isset($database) && $database=="bills") echo "selected";?>  >Bills</option>						<option value="amendments" <?php if (isset($database) && $database=="amendments") echo "selected";?>  >Amendments</option>					</select>				</td>			</tr>			<tr>				<td><label id="chamber_label">Chamber </label></td>				<td>					<input name="chamber" id="chamber_id" type="radio" value="senate" <?php if (isset($chamber) && $chamber!="house") echo "checked";?>>Senate</input>					<input name="chamber" type="radio" id="chamber_id" value="house" <?php if (isset($chamber) && $chamber=="house") echo "checked";?> >House</input>				</td>			</tr>			<tr>				<td><label id="keyword_label"><?php echo $keyword_label;?></label></td>				<input type="hidden" name="keywordLabel" value="<?php echo $keyword_label;?>"/>				<td>					<input id="keyword_id" name="keyword" type="text" value="<?php echo $keyword;?>"></input>				</td>			</tr>			<tr>				<td></td>				<td>					<input type="submit" value="Search" name="submit"/>					<input type="button" value="Clear" name="clear" onclick="javascript:clearForm()"/>				</td>			</tr>			<tr>				<td colspan="2">					<a href="http://sunlightfoundation.com/" target="_blank">Powered By Sunlight Foundation</a>				</td>			</tr>		</table>	</form></div><div id="result" style="margin-top:50px;">	<?php	$state_array = array(		'AL'=>'ALABAMA',		'AK'=>'ALASKA',		'AS'=>'AMERICAN SAMOA',		'AZ'=>'ARIZONA',		'AR'=>'ARKANSAS',		'CA'=>'CALIFORNIA',		'CO'=>'COLORADO',		'CT'=>'CONNECTICUT',		'DE'=>'DELAWARE',		'DC'=>'DISTRICT OF COLUMBIA',		'FM'=>'FEDERATED STATES OF MICRONESIA',		'FL'=>'FLORIDA',		'GA'=>'GEORGIA',		'GU'=>'GUAM GU',		'HI'=>'HAWAII',		'ID'=>'IDAHO',		'IL'=>'ILLINOIS',		'IN'=>'INDIANA',		'IA'=>'IOWA',		'KS'=>'KANSAS',		'KY'=>'KENTUCKY',		'LA'=>'LOUISIANA',		'ME'=>'MAINE',		'MH'=>'MARSHALL ISLANDS',		'MD'=>'MARYLAND',		'MA'=>'MASSACHUSETTS',		'MI'=>'MICHIGAN',		'MN'=>'MINNESOTA',		'MS'=>'MISSISSIPPI',		'MO'=>'MISSOURI',		'MT'=>'MONTANA',		'NE'=>'NEBRASKA',		'NV'=>'NEVADA',		'NH'=>'NEW HAMPSHIRE',		'NJ'=>'NEW JERSEY',		'NM'=>'NEW MEXICO',		'NY'=>'NEW YORK',		'NC'=>'NORTH CAROLINA',		'ND'=>'NORTH DAKOTA',		'MP'=>'NORTHERN MARIANA ISLANDS',		'OH'=>'OHIO',		'OK'=>'OKLAHOMA',		'OR'=>'OREGON',		'PW'=>'PALAU',		'PA'=>'PENNSYLVANIA',		'PR'=>'PUERTO RICO',		'RI'=>'RHODE ISLAND',		'SC'=>'SOUTH CAROLINA',		'SD'=>'SOUTH DAKOTA',		'TN'=>'TENNESSEE',		'TX'=>'TEXAS',		'UT'=>'UTAH',		'VT'=>'VERMONT',		'VI'=>'VIRGIN ISLANDS',		'VA'=>'VIRGINIA',		'WA'=>'WASHINGTON',		'WV'=>'WEST VIRGINIA',		'WI'=>'WISCONSIN',		'WY'=>'WYOMING',		'AE'=>'ARMED FORCES AFRICA \ CANADA \ EUROPE \ MIDDLE EAST',		'AA'=>'ARMED FORCES AMERICA (EXCEPT CANADA)',		'AP'=>'ARMED FORCES PACIFIC'		);	if(isset($_POST['details'])) 	{		$url = $_POST['details'];		$database = $_POST['database'];		$json = file_get_contents($url); // this WILL do an http request for you//		echo print_r($json) . "<br><br>";		$data = json_decode($json, TRUE);		echo createDetailsTable($data, $database);	}	else if(isset($_POST['submit'])) 	{		$url = "http://congress.api.sunlightfoundation.com/";		$chamber_field = "chamber=".$chamber;		$state_field = "state=".strtoupper($keyword);		$state_name_field = "state_name=".ucwords($keyword);		$representative_field = "query=".$keyword;		$api_key = "apikey=4186cea6482f48959f340a5dd7cd2080";		$database = $_POST["database"];		$k = trim($keyword);		if (empty($k) == 1 || preg_match('/[^a-zA-Z\-0-9]/i', $keyword))		{		}		else if($database == "legislators")		{			if((!empty($state_array[strtoupper($keyword)])))			{				$url = $url . "legislators?" . $state_field . "&" . $chamber_field . "&";			}			else if(in_array(strtoupper($keyword), $state_array))			{				$key = array_search (strtoupper($keyword), $state_array);				$state_name_field = "state=".ucwords($key);				$url = $url . "legislators?" . $state_name_field . "&" . $chamber_field . "&";			}			else			{				$url = $url . "legislators?" . $representative_field . "&" . $chamber_field . "&";						}		}		else if($database == "bills")		{			$url = $url . "bills?bill_id=" . $keyword . "&" . $chamber_field . "&";		}		else if($database == "amendments")		{			$url = $url . "amendments?amendment_id=" . $keyword . "&" . $chamber_field . "&";		}		else if($database == "committees")		{			$url = $url . "committees?committee_id=" . $keyword . "&" . $chamber_field . "&";		}		$k = trim($keyword);		if($database != "-1" && empty($k) == 0)		{			$url = $url . $api_key;		$json = file_get_contents($url); // this WILL do an http request for you//		echo print_r($json) . "<br><br>";		$data = json_decode($json, TRUE);//		echo $data->{'token'};//		echo print_r($data);		if(count($data['results']) == 0)		{			echo "<br/><b>The API returned zero results for the request</b><br/>";		}		else		{			echo createTable($data, $database, $url);		}	}}function createTable($data, $database, $url){	$keyword = $_POST['keyword'];	$label = $_POST['keywordLabel'];	$text = "";	$text .= "<table id=\"jsontable\" border=1 style=\"text-align:center;margin:auto;\">";	if($database == "legislators")	{		$r_arr = $data['results'];		$text .= "<tr> <th> Name </th> <th> State </th> <th>Chamber</th><th>Details</th></tr>";		foreach($r_arr as $r)		{			$text .= "<tr>";			$text .= "<td style=\"text-align:left;\">" . $r['first_name'] . " " . $r['last_name'] . "</td>";			$text .= "<td>" . $r['state_name'] . "</td>";			$text .= "<td>" . $r['chamber'] . "</td>";			$chamber = $r['chamber'];			$url .= "&bioguide_id=" . $r['bioguide_id'];			$text .= "<td> <a href=\"javascript:createHiddenForm('$url', '$chamber', '$database', '$keyword', '$label');\">View Details</a></td>";			$text .= "</tr>";		}	}	else if($database == "bills")	{		$r = $data['results'][0];		$text .= "<tr> <th> Bill ID </th> <th> Short Title </th> <th>Chamber</th><th>Details</th></tr>";		$text .= "<tr>";		$text .= "<td>" . $r['bill_id'] . "</td>";		$text .= "<td>" . $r['short_title'] . "</td>";		$text .= "<td>" . $r['chamber'] . "</td>";		$chamber = $r['chamber'];		$text .= "<td> <a href=\"javascript:createHiddenForm('$url', '$chamber', '$database', '$keyword', '$label');\">View Details</a></td>";		$text .= "</tr>";	}	else if($database == "amendments")	{		$r = $data['results'][0];		$text .= "<tr> <th> Amendment ID </th> <th> Amendment Type </th> <th>Chamber</th><th>Introduced On</th></tr>";		$text .= "<tr>";		$text .= "<td>" . $r['amendment_id'] . "</td>";		$text .= "<td>" . $r['amendment_type'] . "</td>";		$text .= "<td>" . $r['chamber'] . "</td>";		$text .= "<td>" . $r['introduced_on'] . "</td>";		$text .= "</tr>";	}	else if($database == "committees")	{		$r = $data['results'][0];		$text .= "<tr> <th> Committee ID </th> <th> Committee Name </th> <th>Chamber</th></tr>";		$text .= "<tr>";		$text .= "<td>" . $r['committee_id'] . "</td>";		$text .= "<td>" . $r['name'] . "</td>";		$text .= "<td>" . $r['chamber'] . "</td>";		$text .= "</tr>";	}	$text .= "</table>";	return $text;}function createDetailsTable($data, $database){	$text = "";	$text .= "<table id=\"bills\" frame=box style=\"text-align:left;margin:auto;\">";	if($database == "legislators")	{		$r = $data['results'][0];		$text .= "<tr><td colspan=2 align=center><img src=\"http://theunitedstates.io/images/congress/225x275/" . $r['bioguide_id'] . ".jpg\" style=\"padding-bottom:20px;\"/></td></tr>";		$text .= "<tr><td>Full Name</td><td>" . $r['title'] . " " . $r['first_name'] . " " . $r['last_name'] . "</td></tr>";		$text .= "<tr><td>Term Ends On</td><td>" . $r['term_end'] . "</td></tr>";		$text .= "<tr><td>Website</td><td><a href=\"" . $r['website'] . "\" target=_blank> " . $r['website'] . "</a> </td></tr>";		$text .= "<tr><td>Office</td><td>" . $r['office'] . "</td></tr>";		$text .= "<tr><td>Facebook</td>";		$text .= "<td>";		if($r['facebook_id'])		{			$text .= "<a href=\"https://www.facebook.com/" . $r['facebook_id'] . "\" target=_blank> " . $r['first_name'] . " " . $r['last_name'] . "</a> ";		}			else		{			$text .= "N/A";		}			$text .= "</td>";		$text .= "</tr>";				$text .= "<tr><td>Twitter</td>";		$text .= "<td>";				if($r['twitter_id'])		{			$text .= "<a href=\"https://twitter.com/" . $r['twitter_id'] . "\" target=_blank> " . $r['first_name'] . " " . $r['last_name'] . "</a> ";		}			else		{			$text .= "N/A";		}			$text .= "</td>";				$text .= "</tr>";			}	else if($database == "bills")	{		$r = $data['results'][0];		$text .= "<tr><td>Bill ID</td><td>" . $r['bill_id'] . "</td></tr>";		$text .= "<tr><td>Bill Title</td><td>" . $r['short_title'] . "</td></tr>";		$text .= "<tr><td>Sponsor</td><td>" . $r['sponsor']['title'] . " " . $r['sponsor']['first_name'] . " " . $r['sponsor']['last_name'] . "</td></tr>";		$text .= "<tr><td>Introduced On</td><td>" . $r['introduced_on'] . "</td></tr>";		$text .= "<tr><td>Last action with date</td><td>" . $r['last_version']['version_name'] . ", " . $r['last_action_at'] . "</td></tr>";		$text .= "<tr><td>Bill URL</td><td><a href=\"" . $r['last_version']['urls']['pdf'] ."\" target=_blank>" . $r['short_title'] . "</a></td></tr>";	}	$text .= "</table>";	return $text;}?></div><div style="clear:both; height:50px;"></div></body></html>